# 6.1 논리 볼륨 (Logical Volume)

- 논리 볼륨은 디스크 파티션의 구조와 상관 없이 원하는 크기의 논리 볼륨을 생성할 수 있음
- 논리 볼륨으로 생성된 볼륨의 사이즈가 부족할 경우 볼륨 확장 가능. 이때 볼륨의 데이터를 그대로 유지한 상태에서 확장 가능
- 데이터를 유지한 상태에서 논리 볼륨을 구성하고 있는 데이터 제거 가능
- 논리 볼륨 생성시 RAID를 적용한 볼륨을 생성할 수 있음
- 스냅샷(Snapshot) 기능 확인 가능

### 논리 볼륨 구성
> (디스크 장치 ->) 물리 볼륨 (Physical Volume) -> 볼륨 그룹 (Volume Group) -> 논리 볼륨 (Logical Volume)
## 6.1.1 물리 볼륨 (PV) 
```
[vagrant@user01 ~]$ sudo fdisk /dev/sdb
...
Command (m for help): t
Hex code or alias (type L to list all): 8E

[vagrant@user01 ~]$ sudo fdisk -l /dev/sdb
Disk /dev/sdb: 20 GiB, 21474836480 bytes, 41943040 sectors
Disk model: HARDDISK
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x9da88705

Device     Boot Start      End  Sectors Size Id Type
/dev/sdb1        2048 41943039 41940992  20G 8e Linux LVM # LVM 타입 생성 완료
```
```
[vagrant@user01 ~]$ sudo partprobe /dev/sdb 
[vagrant@user01 ~]$ sudo lvmdiskscan # 디스크 정보 확인
  /dev/sda1 [     600.00 MiB] 
  /dev/sda2 [       1.00 GiB]
  /dev/sda3 [      48.41 GiB]
  /dev/sdb1 [     <20.00 GiB]
  0 disks
  4 partitions
  0 LVM physical volume whole disks
  0 LVM physical volumes

[vagrant@user01 ~]$ sudo pvcreate /dev/sdb1 # PV 생성
  Physical volume "/dev/sdb1" successfully created.
  Creating devices file /etc/lvm/devices/system.devices

```
## 6.1.2 볼륨 그룹 (VG)
```
[vagrant@user01 ~]$ sudo vgcreate vg_data /dev/sdb1 # vg 생성
  Volume group "vg_data" successfully created
[vagrant@user01 ~]$  sudo vgdisplay
  --- Volume group ---
  VG Name               vg_data
  System ID
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  1
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                0
  Open LV               0
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               <20.00 GiB
  PE Size               4.00 MiB
  Total PE              5119
  Alloc PE / Size       0 / 0
  Free  PE / Size       5119 / <20.00 GiB
  VG UUID               LVy8us-L8w3-m4M0-Cwe3-7gYf-Rsyf-TAwYGt

[vagrant@user01 ~]$ sudo vgs # vg를 간단하게 확인
  VG      #PV #LV #SN Attr   VSize   VFree  
  vg_data   1   0   0 wz--n- <20.00g <20.00g
```
## 6.1.3 논리 볼륨 (LV)
```
[vagrant@user01 ~]$ sudo lvcreate -n lv_data -L 10G vg_data # LV 생성
  Logical volume "lv_data" created.

  [vagrant@user01 ~]$ sudo lvdisplay # lv 확인 또는 아래
  # sudo lvdisplay /dev/vg_data/lv_data 
  --- Logical volume ---
  LV Path                /dev/vg_data/lv_data
  LV Name                lv_data
  VG Name                vg_data
  LV UUID                GUOWMI-Oa3Y-pOMg-Hzwb-yqZ6-PPCQ-x3XXeh
  LV Write Access        read/write
  LV Creation host, time user01, 2025-10-27 05:38:12 +0000
  LV Status              available
  # open                 0
  LV Size                10.00 GiB
  Current LE             2560
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     8192
  Block device           253:0

  [vagrant@user01 ~]$ sudo lvs # lv 간단하게 확인
  LV      VG      Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  lv_data vg_data -wi-a----- 10.00g
```

```
[vagrant@user01 ~]$ sudo mkfs.xfs /dev/vg_data/lv_data # 파일 시스템 생성

[vagrant@user01 ~]$ sudo mkdir /mnt/data # 마운트할 디렉터리 생성
[vagrant@user01 ~]$ sudo mount /dev/vg_data/lv_data /mnt/data # 마운트
mount: (hint) your fstab has been modified, but systemd still uses
       the old version; use 'systemctl daemon-reload' to reload.
```
```
[vagrant@user01 ~]$ sudo lvextend -L 15G /dev/vg_data/lv_data # 사이즈 변경
  Size of logical volume vg_data/lv_data changed from 10.00 GiB (2560 extents) to 15.00 GiB (3840 extents).
  Logical volume vg_data/lv_data successfully resized.
```
> 논리볼륨의 크기는 증가했지만 파일 시스템의 크기는 아직 증가하지 않음
> 메타 데이터가 아직 업데이트가 안 돼서 파일 시스템도 확장을 해주어야 함
```
[vagrant@user01 ~]$ df -h /mnt/data
Filesystem                   Size  Used Avail Use% Mounted on
/dev/mapper/vg_data-lv_data   10G  104M  9.9G   2% /mnt/data
[vagrant@user01 ~]$ sudo lvs
  LV      VG      Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  lv_data vg_data -wi-ao---- 15.00g

[vagrant@user01 ~]$ sudo xfs_growfs /mnt/data/ # 파일 시스템 확장
[vagrant@user01 ~]$ df -h /mnt/data # 확장 결과
Filesystem                   Size  Used Avail Use% Mounted on
/dev/mapper/vg_data-lv_data   15G  140M   15G   1% /mnt/data
```
>LV 삭제
```
[vagrant@user01 ~]$ sudo lvremove /dev/vg_data/lv_data
Do you really want to remove active logical volume vg_data/lv_data? [y/n]: y
  Logical volume "lv_data" successfully removed.
```
> VG 삭제
```
[vagrant@user01 ~]$ sudo vgremove vg_data
  Volume group "vg_data" successfully removed
```
> PV 삭제
```
[vagrant@user01 ~]$ sudo pvremove /dev/sdb1
  Labels on physical volume "/dev/sdb1" successfully wiped.
```

