# 1.1 사용자 및 그룹 정보 파일
  - `사용자 (User)`: 실제로 시스템을 사용하려는 사람과 연결한 계정
  - `UID (User ID)`: 유니크한 사용자 번호
  (uid가 같으면 사용자가 달라도 시스템 상에서는 같은 것으로 인식)
  ```
  [vagrant@user01 ~]$ id
  uid=1000(vagrant) gid=1000(vagrant) groups=1000(vagrant) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023
  ```
  - 시스템 사용자는 1~999번을 차지

## 그룹
  - `그룹 (group)`: 사용자를 묶어서 더 쉽게 관리하기 위함. gid로 같은 그룹 식별
  - `gid`는 기본 그룹, `groups`는 보조 그룹을 의미

## /etc/passwd
  - 시스템에 등록된 사용자 정보
  - etc는 설정 파일이 들어있는 디렉터리
  > USER:X:UID:GID:GECOS:HOME:SHELL

```
  [vagrant@user01 ~]$ tail -1 /etc/passwd
  vagrant:x:1000:1000::/home/vagrant:/bin/bash
```

## /etc/shadow
- 시스템에 등록된 사용자의 패스워드와 패스워드에 대한 설정
- 기본적으로는 아무에게도 권한이 없음. sudo를 사용해야 읽기 가능
- 원래는 소유자(root) 또한 읽기 권한이 없는 게 맞는데 sudo를 하면 가능함
> USER:HASH:LASTCHANCE:MIN:MAX:WARNING:INACTIVE:EXPIRE:BLANK
```
[vagrant@user01 ~]$ sudo cat /etc/shadow
root:$6$itYmGlN1xC35VD7C$kr/aM/snW44SYqNT/ZVKhpgNa.sDY9/IXfXnxWyyTrvl4LNoBq3QN9OifN/HgOUo00rNhWStxH8K0RSMSLSiN0::0:99999:7:::
bin:*:19820:0:99999:7:::
daemon:*:19820:0:99999:7:::
...
vagrant:$6$K5FN/En70FxX2rlm$wUUOz2w5L1ZpLGrIAp4YNi8ycK.24dAONnI0sV1nzWkA9tZfSIsZu5yvlgpTx.WLOPBM7DdkGjjHhCL7hUHMi/::0:99999:7:::
```

## /etc/group
- 그룹에 대한 정보 저장
- `wheel` 그룹에서는 root의 권한을 빌려쓸 수 있음
> GROUP:X:GID:MEMBER

```
cat /etc/group # 그룹의 GID와 그룹 구성원 확인 
```

# 1.2 사용자 및 그룹 관리
## 사용자 생성
> useradd [option] user-name
- 사용자가 생성되면 /etc/passwd 파일과 /etc/shadow 파일 가장 마지막에 사용자 정보가 추가됨
- 새로 생성된 사용자는 패스워드가 설정되어 있지 않아, 이 사용자로 로그인하기 위해선 패스워드를 지정해야 함
  - `m`: 사용자의 홈 디렉터리가 존재하지 않을 경우 생성
  - `d`: 사용자의 홈 디렉터리 지정
  - `s`: 사용자의 기본 쉘 지정
  - `g`: 사용자의 기본 그룹 지정
  - `G`: 사용자의 보조 그룹 지정
  - `c`: 사용자에 대한 주석 지정
  - `u`: 사용자의 UID 지정

```
# 사용자 생성
[vagrant@user01 ~]$ sudo useradd -m -d /home/student1 -s /bin/bash -g users -G wheel -c "Student Test" -u 1500 student1 

[vagrant@user01 ~]$ tail -n1 /etc/passwd # 생성된 사용자 확인
student1:x:1500:100:Student Test:/home/student1:/bin/bash
```

## 사용자 패스워드 설정
```
[vagrant@user01 ~]$ sudo passwd student1
Changing password for user student1.
New password: 
BAD PASSWORD: The password is shorter than 8 characters
Retype new password: 
passwd: all authentication tokens updated successfully.
```

## 사용자 변경
> usermod [option] user-name
```
[vagrant@user01 ~]$ su - student1
Password: 
[student1@user01 ~]$ # 변경 완료
[student1@user01 ~]$ exit
logout # 로그아웃 완료
```

* useradd와 adduser 비교
```
[vagrant@user01 ~]$ ls -l /usr/sbin/useradd
-rwxr-xr-x. 1 root root 141328 Dec 17  2024 /usr/sbin/useradd
[vagrant@user01 ~]$ ls -l /usr/sbin/adduser
lrwxrwxrwx. 1 root root 7 Dec 17  2024 /usr/sbin/adduser -> useradd
```
-> 즉, adduser는 useradd를 심볼릭 링크로 연결

## 사용자 정보 수정
- `a`: -G 옵션과 같이 사용하며 홈 디렉터리를 이동할 때 사용
- `G GID`: 사용자의 보조 그룹을 변경. 기존의 보조 그룹정보는 삭제
```
[vagrant@user01 ~]$ sudo usermod -s /bin/zsh student1 # 기본 실행 쉘을 변경
usermod: Warning: missing or non-executable shell '/bin/zsh'
[vagrant@user01 ~]$ grep student1 /etc/passwd # 결과 확인
student1:x:1500:100:Student Test:/home/student1:/bin/zsh
```
```
[vagrant@user01 ~]$ sudo usermod -aG vagrant student1 # student1 에게 vagrant 보조그룹 추가
[vagrant@user01 ~]$ id student1
uid=1500(student1) gid=100(users) groups=100(users),10(wheel),1000(vagrant)
```

## 사용자 삭제
> userdel [option] user-name
- **삭제할 때 `r` 옵션 권장** -> 옵션을 사용하지 않으면 삭제된 사용자의 홈 디렉터리가 남게 되고, 남아있는 홈 디렉터리와 파일은 삭제된 사용자와 같은 UID로 새로 생성된 사용자가 소유할 수 있어 보안상 문제를 발생시킬 수 있음
```
[student1@user01 ~]$ su - student1
Password: 
Last login: Tue Oct 14 16:43:45 UTC 2025 on pts/0

[student1@user01 ~]$ echo "비밀번호" > co-pw
[student1@user01 ~]$ sudo - student1
sudo: -: command not found
[student1@user01 ~]$ exit
logout
[vagrant@user01 ~]$ sudo userdel student1

[vagrant@user01 ~]$ ls -l /home
total 4
drwx------.  2      1001      1001   62 Oct 14 15:43 asdf
drwx------.  2      1500 users       96 Oct 14 16:45 student1
...
# 바로 접근할 수는 없으나 student1 디렉터리가 남아있음

[vagrant@user01 ~]$ sudo useradd -u 1500 student2 # UID가 1500인 student2 사용자 생성 
[vagrant@user01 ~]$ ls -l /home/
total 4
drwx------.  2      1001      1001   62 Oct 14 15:43 asdf
drwx------.  2 student2  users       96 Oct 14 16:45 student1
drwx------.  2 student2  student2    62 Oct 14 16:48 student2
...

[vagrant@user01 ~]$ sudo su - student2 # student2로 접속
[student2@user01 ~]$ ls # 신규 사용자이므로 본인의 홈 디렉터리는 비어있음
[student2@user01 ~]$ cd ../student1 # student1 사용자 디렉터리 접근 가능 
[student2@user01 student1]$ ls
co-pw
[student2@user01 student1]$ cat co-pw
비밀번호

```

## 그룹 추가
> groupadd [option] group-name
```
[vagrant@user01 ~]$ sudo groupadd rocky # rocky라는 그룹 추가
[vagrant@user01 ~]$ sudo groupadd -g 2000 infra # gid가 2000인 infra라는 그룹 추가
[vagrant@user01 ~]$ tail -2 /etc/group # 마지막으로 추가된 2개 그룹 확인
rocky:x:1504:
infra:x:2000:

[vagrant@user01 ~]$ sudo groupmod -n infrateam infra # infra라는 그룹명을 infrateam으로 변경
[vagrant@user01 ~]$ sudo groupmod -g 3000 infrateam # infrateam 그룹의 gid를 3000으로 변경

[vagrant@user01 ~]$ sudo useradd infra -g infrateam 
[vagrant@user01 ~]$ sudo groupdel infrateam 
groupdel: cannot remove the primary group of user 'infra'
# 어떤 사용자의 기본 그룹인 경우 그룹 삭제 불가능. 삭제를 위해선 사용자를 다른 그룹으로 변경해야 함
```

## 사용자 및 그룹 관리 파일
### /etc/skel
- 사용자에 대한 기본 초기화 파일을 저장하고 있는 디렉터리
- 사용자를 생성할 때 /etc/skel 디렉터리 내의 모든 파일들이 해당 사용자의 홈 디렉터리로 복사됨
```
[vagrant@user01 ~]$ ls -la /etc/skel
...
-rw-r--r--.   1 root root   18 Apr 30  2024 .bash_logout
-rw-r--r--.   1 root root  141 Apr 30  2024 .bash_profile
-rw-r--r--.   1 root root  492 Apr 30  2024 .bashrc
...
```

# 1.3 사용자 전환
## su
- `su(Switch User)`는 사용자를 전환함
(단, su 명령을 사용하여 사용자를 전환하려면 반드시 그 사용자의 패스워드를 알고 있어야 함)
- 인자 없이 사용하면 root 사용자가 지정됨
- su 명령이 성공하면 /etc/passwd 파일에 지정된 사용자의 쉘을 실행
```
[vagrant@user01 ~]$ echo $PATH
/home/vagrant/.local/bin:/home/vagrant/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin
[root@user01 vagrant]# echo $PATH
/root/.local/bin:/root/bin:/home/vagrant/.local/bin:/home/vagrant/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin
```
- `sudo su`: 현재 사용자 환경 유지. 임시 root 권한
- `sudo su -`: root 로그인 환경으로 전환 (sudo -i)

=> 즉, 대시 옵션을 지정하면 해당 사용자의 홈 디렉터리에 있는 설정들을 전부 읽어오기 때문에 환경변수가 적용되고, 로그인 시 기본 작업공간인 홈 디렉터리로 이동하게 됨
## sudo
> sudo [option] [user-name] command
- 로그아웃을 하지 않고 특정 사용자의 권한으로 명령을 수행
- 사용자를 지정하지 않으면 root 사용자의 권한으로 명령을 수행
=> 즉, sudo 명령을 사용하는 시점에서만 특정 사용자의 권한을 얻음



## sudoers
```
[vagrant@user01 ~]$ sudo vi /etc/sudoers.d/vagrant
# vagrant 사용자에 대한 sudo 권한 설정 파일을 root 권한으로 편집

vagrant ALL=(ALL) NOPASSWD:ALL
# vagrant → 사용자 이름
# ALL=(ALL) → 어떤 호스트, 어떤 사용자 권한으로든 실행 가능
# NOPASSWD:ALL → sudo 명령 시 비밀번호 묻지 않음
```
또는 `sudo visudo`로 문법 검사 가능
```
[vagrant@user01 ~]$ sudo visudo
```

- `su`와 `sudo` 명령은 로그로 남음 (우분투의 경우는 /var/log/auth.log에 저장)
```
sudo tail /var/log/secure
```